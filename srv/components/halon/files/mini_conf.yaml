{% set node = grains['id'] %}
{%- if pillar['cluster']['type'] == "single" -%}
s3servers:
  - {{ node }}
clovis_apps:
  - {{ node }}
confds:
  - {{ node }}
ssus:
  - host: {{ node }}
    disks: [{{ ', '.join(pillar['cluster'][node]['storage']['data_devices']) }}]
{% else -%}
s3servers:
{%- for node_id in pillar['cluster']['node_list'] %}
  - {{ pillar['cluster'][node_id]['fqdn'] }}
{%- endfor %}
clovis_apps:
{%- for node_id in pillar['cluster']['node_list'] %}
  - {{ pillar['cluster'][node_id]['fqdn'] }}
{%- endfor -%}
{% for node_id in pillar['cluster']['node_list'] -%}
{% if pillar['cluster'][node_id]['is_primary'] %}
confds:
  - {{ pillar['cluster'][node_id]['fqdn'] }}
{%- endif -%}
{% endfor %}
ssus:
{%- for node_id in pillar['cluster']['node_list'] %}
  - host: {{ pillar['cluster'][node_id]['fqdn'] }}
    disks: [{{ ', '.join(pillar['cluster'][node_id]['storage']['data_devices']) }}]
{%- endfor %}
{%- endif -%}
